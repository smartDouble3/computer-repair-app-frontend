<!doctype html><html lang="th">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login</title>
  <link rel="stylesheet" href="form-theme.css">
  <script src="common.js" defer></script>
  <link rel="stylesheet" href="login.css">
</head>
<body>
  <div class="container">
  <div class="form-container" id="loginForm">
    <h1>เข้าสู่ระบบ</h1>
    <form id="loginFormReal">
      <div class="login_sign">
        <div class="input-group">
          <input type="email" placeholder="อีเมล" required id="E_mail_login" class="Login_box">
        </div>
        <div class="input-group">
          <input type="password" placeholder="รหัสผ่าน" required id="Password_login" class="Login_box" minlength="6">
        </div>
        <div class="btu">
          <button type="submit" id="Confirm">เข้าสู่ระบบ</button>
        </div>
      </div>
    </form>
    <div id="loginMessage" class="err"></div>
    <div class="DOT">
      <p>ยังไม่มีบัญชี? 
        <span class="switch-form" onclick="location.href='register.html'">สมัครสมาชิก</span>
      </p>
    </div>
  </div>
</div>


  <script>
document.addEventListener('DOMContentLoaded', () => {
  // ถ้ามี token แล้วไปเมนู
  if (isAuthed()) { location.href = 'menu.html'; return; }

  // ====== map ID ให้ตรงกับฟอร์มใหม่ ======
  const form  = document.getElementById('loginFormReal');
  const email = document.getElementById('E_mail_login');
  const pass  = document.getElementById('Password_login');
  const msgEl = document.getElementById('loginMessage');
  const btn   = document.getElementById('Confirm');

  if (!form || !email || !pass || !msgEl) {
    console.error('Login form elements not found.');
    return;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msgEl.textContent = '';
    btn.disabled = true;

    try {
      const res = await api('/auth/login', {
        method: 'POST',
        body: { email: email.value.trim(), password: pass.value }
      });
      setToken(res.token);
      location.href = 'menu.html';
    } catch (err) {
      // แสดงข้อความจาก backend ถ้ามี
      msgEl.textContent = (err?.data?.message) || err.message || 'ล็อกอินไม่สำเร็จ';
      console.error('LOGIN FAILED ->', err);
    } finally {
      btn.disabled = false;
    }
  });
});
</script>

</body>
</html>
