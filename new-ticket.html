<!doctype html><html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</title>
  <link rel="stylesheet" href="form-theme.css" />
  <script src="common.js" defer></script>
  <style>
    .shell { max-width: 980px; margin: 18px auto; }
    .hero { background: linear-gradient(90deg,#f6a21b,#e29012); color:#222;
            border-radius:18px 18px 0 0; padding:18px 20px; box-shadow:0 6px 18px rgba(0,0,0,.12); }
    .hero h1 { margin:0; font-size:28px; display:flex; gap:10px; align-items:center; color:#222; }
    .tabbar { display:flex; gap:12px; margin-top:10px; }
    .tab { padding:8px 12px; border-radius:10px; background:#fff3; color:#222; font-weight:700; }
    .tab.active { background:#fff; box-shadow:0 3px 10px rgba(0,0,0,.12); }
    .card { background:#fff; border:1px solid #e5e7eb; border-top:0; padding:18px; border-radius:0 0 18px 18px;
            box-shadow:0 16px 36px rgba(0,0,0,.08); }
    .grid { display:grid; grid-template-columns:repeat(12,1fr); gap:14px; }
    .col-6 { grid-column:span 6; } .col-12{ grid-column:span 12; } .col-3{grid-column:span 3;}
    .label { font-size:14px; color:#374151; margin:6px 0 4px; display:block; }
    .req:after { content:" *"; color:#ef4444; }
    .input, .select, textarea { width:100%; background:#fff; border:1px solid #d1d5db; border-radius:12px;
      padding:12px 14px; font-size:16px; outline:none; box-shadow:0 2px 8px rgba(0,0,0,.06) inset; }
    textarea { min-height:120px; resize:vertical; }
    .hint { font-size:12px; color:#6b7280; margin-top:6px; }
    .uploader { border:2px dashed #d1d5db; border-radius:12px; height:180px; display:flex; align-items:center; justify-content:center; background:#fafafa; }
    .uploader input[type="file"]{ display:none; }
    .upbtn { background:none; border:0; color:#6b7280; cursor:pointer; font-weight:700; }
    .actions { display:flex; gap:12px; justify-content:flex-end; margin-top:18px; }
    .btn { border:0; padding:12px 18px; border-radius:12px; font-weight:800; cursor:pointer; }
    .btn.primary { background:linear-gradient(90deg,#6d63ff,#7e57c2); color:#fff; box-shadow:0 8px 20px rgba(126,87,194,.35); }
    .msg { margin-top:10px; text-align:center; font-weight:700; }
    .msg.err { color:#b91c1c; } .msg.ok { color:#0f766e; }
    @media (max-width:840px){ .col-6,.col-3{grid-column:span 12;} }
  </style>
</head>
<body>
  <div class="shell">
    <div class="hero">
      <h1>üõ†Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</h1>
      <div class="tabbar">
        <span class="tab active">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</span>
        <a class="tab" href="my-tickets.html" style="text-decoration:none">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a>
      </div>
    </div>

    <div class="card">
      <form id="form" autocomplete="off">
        <div class="grid">

          <div class="col-6">
            <label class="label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
            <input id="c_name" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß ‡∏™‡∏°‡πÉ‡∏à ‡πÉ‡∏à‡∏î‡∏µ">
          </div>

          <div class="col-6">
            <label class="label req">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
            <input id="c_phone" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678" required>
          </div>

          <div class="col-6">
            <label class="label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input id="c_email" type="email" class="input" placeholder="email@example.com">
          </div>

          <div class="col-6">
            <label class="label">‡πÅ‡∏ú‡∏ô‡∏Å/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label>
            <input id="c_dept" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏ô‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
          </div>

          <div class="col-6">
            <label class="label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
            <input id="c_place" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏´‡πâ‡∏≠‡∏á 301">
          </div>

          <div class="col-6">
            <label class="label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</label>
            <select id="c_urgency" class="select">
              <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô ‚Äî</option>
              <option>LOW</option>
              <option>MEDIUM</option>
              <option>HIGH</option>
              <option>CRITICAL</option>
            </select>
          </div>

          <div class="col-6">
            <label class="label req">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
            <select id="dev_type" class="select" required>
              <option value="">‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‚Äî</option>
              <option>PC</option>
              <option>LAPTOP</option>
              <option>PRINTER</option>
              <option>MONITOR</option>
              <option>NETWORK</option>
              <option>OTHER</option>
            </select>
          </div>

          <div class="col-3">
            <label class="label">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏£‡∏∏‡πà‡∏ô (‡∏¢‡πà‡∏≠)</label>
            <input id="brand" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô Dell / Lenovo">
          </div>

          <div class="col-3">
            <label class="label">‡πÇ‡∏°‡πÄ‡∏î‡∏•</label>
            <input id="model" class="input" placeholder="‡πÄ‡∏ä‡πà‡∏ô XPS 13 / IdeaPad">
          </div>

          <div class="col-12">
            <label class="label req">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤</label>
            <textarea id="desc" class="input" required
              placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error, ‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
            <div class="hint">‡πÄ‡∏ä‡πà‡∏ô: ‡∏Ñ‡∏≠‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠‡∏ü‡πâ‡∏≤, ‡πÄ‡∏õ‡∏¥‡∏î‡∏ä‡πâ‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏≤‡∏ß</div>
          </div>
    
        </div>

        <div class="actions">
          <button type="button" class="btn gray" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button class="btn primary" id="btnSubmit">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ã‡πà‡∏≠‡∏°</button>
        </div>
        <div id="msg" class="msg"></div>
      </form>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    requireAuth(); // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô
  });

  const form = document.getElementById('form');
  const msg  = document.getElementById('msg');
  const btnClear = document.getElementById('btnClear');

  btnClear.onclick = () => { form.reset(); msg.textContent=''; msg.className='msg'; };

  form.addEventListener('submit', async (e) => {
    e.preventDefault(); msg.textContent=''; msg.className='msg';

    // === ‡∏™‡∏£‡πâ‡∏≤‡∏á payload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ /tickets (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ï‡∏≤‡∏° backend ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) ===
    const title = buildTitle();
    const details = buildDetailsBlock(); // ‡πÅ‡∏ô‡∏ö‡∏•‡∏á description ‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó

    const payload = {
      title,
      description: details,
      device_brand: document.getElementById('brand').value.trim() || document.getElementById('dev_type').value,
      device_model: document.getElementById('model').value.trim() || undefined,
      // assigned_employee_id: undefined // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≤‡∏á ‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°
    };

    try{
      const r = await api('/tickets', { method:'POST', body: payload });
      msg.className = 'msg ok';
      msg.textContent = '‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‚Ä¶';
      setTimeout(()=> location.href = 'my-tickets.html', 700);
    }catch(err){
      msg.className = 'msg err';
      msg.textContent = err.message || '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
    }
  });

  // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≤‡∏á
  function buildTitle(){
    const type = document.getElementById('dev_type').value || '-';
    const urgency = document.getElementById('c_urgency').value || 'NORMAL';
    const short = document.getElementById('brand').value.trim() || document.getElementById('model').value.trim() || type;
    return `[${urgency}] ${type} - ${short}`;
  }

  // ‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà + ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ô‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô description)
  function buildDetailsBlock(){
    const v = id => document.getElementById(id).value.trim();
    const lines = [
      '=== ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á/‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ===',
      `‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${v('c_name')||'-'}`,
      `‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: ${v('c_phone')||'-'}`,
      `‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${v('c_email')||'-'}`,
      `‡πÅ‡∏ú‡∏ô‡∏Å/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô: ${v('c_dept')||'-'}`,
      `‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${v('c_place')||'-'}`,
      `‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô: ${v('c_urgency')||'NORMAL'}`,
      '',
      '=== ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ===',
      `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${v('dev_type')||'-'}`,
      `‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ (‡∏¢‡πà‡∏≠): ${v('brand')||'-'}`,
      `‡πÇ‡∏°‡πÄ‡∏î‡∏•: ${v('model')||'-'}`,
      '',
      '=== ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ===',
      v('desc') || '-'
    ];
    return lines.join('\n');
  }
  </script>
</body>
</html>
